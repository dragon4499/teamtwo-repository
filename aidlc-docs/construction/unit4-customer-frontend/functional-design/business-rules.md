# Business Rules - Unit 4: Customer Frontend

---

## 1. 테이블 인증 플로우 규칙

### 1.1 초기 설정 (TableSetupPage)
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| AUTH-01 | 최초 1회 설정 | 설정 완료 후 localStorage에 저장, 이후 자동 로그인만 수행 |
| AUTH-02 | 필수 입력 검증 | storeId(문자열, 비어있지 않음), tableNumber(양의 정수), password(비어있지 않음) |
| AUTH-03 | 설정 저장 | 인증 성공 시 storeId, tableNumber, password를 localStorage에 저장 |
| AUTH-04 | 설정 실패 처리 | 인증 실패 시 모달로 오류 메시지 표시, 입력값 유지 |

### 1.2 자동 로그인
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| AUTH-05 | 앱 시작 시 자동 로그인 | localStorage에 설정 정보가 있으면 자동으로 테이블 인증 API 호출 |
| AUTH-06 | 세션 복원 | 인증 성공 시 sessionId, expiresAt을 AuthContext에 저장 |
| AUTH-07 | 자동 로그인 실패 | 실패 시 TableSetupPage로 리다이렉트 |
| AUTH-08 | 설정 미완료 | localStorage에 설정 정보 없으면 TableSetupPage 표시 |

### 1.3 세션 관리
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| AUTH-09 | 세션 만료 감지 | expiresAt과 현재 시각 비교, 만료 시 자동 재인증 시도 |
| AUTH-10 | 재인증 실패 | 재인증 실패 시 모달로 "세션 만료" 안내 후 TableSetupPage 이동 |

---

## 2. 메뉴 탐색 규칙

### 2.1 카테고리 네비게이션
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| MENU-01 | 좌측 세로 사이드바 | 화면 좌측에 카테고리 목록을 세로로 고정 배치 |
| MENU-02 | "전체" 카테고리 | 카테고리 목록 최상단에 "전체" 옵션 제공 (기본 선택) |
| MENU-03 | 카테고리 추출 | 메뉴 데이터에서 고유 카테고리 자동 추출 |
| MENU-04 | 선택 상태 강조 | 현재 선택된 카테고리를 시각적으로 강조 (배경색 변경) |
| MENU-05 | 카테고리 필터링 | 선택된 카테고리에 해당하는 메뉴만 표시, "전체" 선택 시 모든 메뉴 표시 |

### 2.2 메뉴 카드 표시
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| MENU-06 | 카드 레이아웃 | 메뉴를 카드 형태로 그리드 배치 (사이드바 우측 영역) |
| MENU-07 | 카드 정보 표시 | 메뉴명, 가격, 설명, 플레이스홀더 이미지 표시 |
| MENU-08 | 가격 형식 | 가격을 원 단위로 표시, 천 단위 콤마 (예: "9,000원") |
| MENU-09 | 품절 표시 | is_available=false인 메뉴는 "품절" 표시, 수량 선택 비활성화 |
| MENU-10 | 수량 선택 UI | 각 메뉴 카드에 +/- 버튼과 현재 수량 표시 |

### 2.3 메뉴 데이터 로딩
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| MENU-11 | 초기 로딩 | 인증 완료 후 메뉴 데이터 자동 로드 |
| MENU-12 | 로딩 상태 | 메뉴 로딩 중 스피너/스켈레톤 표시 |
| MENU-13 | 로딩 실패 | 실패 시 토스트 오류 메시지 + "재시도" 버튼 |
| MENU-14 | 빈 메뉴 | 메뉴가 없을 경우 "등록된 메뉴가 없습니다" 안내 |

---

## 3. 장바구니 관리 규칙

### 3.1 메뉴 추가
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| CART-01 | 수량 선택 후 추가 | 메뉴 카드에서 +/- 버튼으로 수량 선택, 수량 > 0이면 장바구니에 반영 |
| CART-02 | 동일 메뉴 수량 증가 | 이미 장바구니에 있는 메뉴의 + 클릭 시 수량 증가 |
| CART-03 | 추가 피드백 | 수량 변경 시 하단 장바구니 바의 수량/총액 즉시 업데이트 |
| CART-04 | 품절 메뉴 차단 | is_available=false인 메뉴는 +/- 버튼 비활성화 |

### 3.2 수량 조절
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| CART-05 | 수량 증가 | + 버튼 클릭 시 수량 1 증가 |
| CART-06 | 수량 감소 | - 버튼 클릭 시 수량 1 감소 |
| CART-07 | 최소 수량 | 수량이 1일 때 - 클릭 시 수량 0 → 장바구니에서 제거 |
| CART-08 | 최대 수량 | 최대 수량 99개 제한, 초과 시 토스트 안내 |
| CART-09 | 즉시 반영 | 수량 변경 시 소계, 총액 즉시 재계산 |

### 3.3 항목 삭제
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| CART-10 | 개별 삭제 | 장바구니 페이지에서 각 항목에 삭제(X) 버튼 제공 |
| CART-11 | 삭제 즉시 반영 | 삭제 시 목록에서 즉시 제거, 총액 재계산 |
| CART-12 | 전체 비우기 | "장바구니 비우기" 버튼 → 확인 모달 → 전체 삭제 |
| CART-13 | 빈 장바구니 안내 | 장바구니가 비어있으면 "장바구니가 비어있습니다" + "메뉴 보기" 버튼 |

### 3.4 총액 계산
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| CART-14 | 소계 계산 | 각 항목: subtotal = price × quantity |
| CART-15 | 총액 계산 | totalAmount = sum(모든 항목의 subtotal) |
| CART-16 | 총 수량 계산 | totalCount = sum(모든 항목의 quantity) |
| CART-17 | 정수 연산 | 모든 금액은 정수(원 단위)로 계산, 소수점 없음 |

### 3.5 데이터 영속화 (localStorage)
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| CART-18 | 자동 저장 | 장바구니 변경 시 즉시 localStorage에 저장 |
| CART-19 | 자동 복원 | 앱 시작 시 localStorage에서 장바구니 데이터 복원 |
| CART-20 | 저장 키 | localStorage 키: `cart_{storeId}_{tableNumber}` |
| CART-21 | 주문 완료 시 비우기 | 주문 성공 후 장바구니 데이터 삭제 (localStorage 포함) |
| CART-22 | 저장 실패 처리 | localStorage 저장 실패 시 토스트 경고 (기능은 계속 동작) |

---

## 4. 주문 생성 규칙

### 4.1 주문 확인 (OrderConfirmPage)
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| ORDER-01 | 확인 페이지 진입 | 장바구니 페이지에서 "주문하기" 클릭 시 이동 |
| ORDER-02 | 빈 장바구니 차단 | 장바구니가 비어있으면 확인 페이지 진입 불가, 메뉴 페이지로 리다이렉트 |
| ORDER-03 | 전체 수정 가능 | 확인 페이지에서 수량 +/- 조절 및 항목 삭제 가능 |
| ORDER-04 | 테이블 번호 표시 | 확인 화면에 현재 테이블 번호 표시 |
| ORDER-05 | 확정/취소 버튼 | "주문 확정" 버튼과 "돌아가기" 버튼 명확히 구분 |

### 4.2 주문 확정 처리
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| ORDER-06 | 주문 전송 | "주문 확정" 클릭 시 API 호출 (storeId, tableNumber, sessionId, items) |
| ORDER-07 | 로딩 상태 | 전송 중 로딩 인디케이터 표시, 버튼 비활성화 (중복 전송 방지) |
| ORDER-08 | 성공 처리 | 주문 성공 시 장바구니 비우기 → OrderSuccessPage 이동 |
| ORDER-09 | 주문 데이터 구성 | CartItemData → OrderItemRequest 변환 (menuId, quantity만 전송) |

### 4.3 주문 성공 (OrderSuccessPage)
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| ORDER-10 | 주문 번호 표시 | 생성된 주문 번호를 크게 표시 |
| ORDER-11 | 자동 리다이렉트 | 5초 카운트다운 후 메뉴 페이지로 자동 이동 |
| ORDER-12 | 카운트다운 표시 | "N초 후 메뉴 화면으로 이동합니다" 카운트다운 표시 |
| ORDER-13 | 주문 내역 링크 | "주문 내역 보기" 링크 제공 |

### 4.4 주문 실패 처리
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| ORDER-14 | 장바구니 보존 | 주문 실패 시 장바구니 데이터 유지 |
| ORDER-15 | 오류 유형 구분 | 네트워크 오류 vs 서버 오류 구분하여 모달 표시 |
| ORDER-16 | 재시도 버튼 | 모달에 "재시도" 버튼 제공 |
| ORDER-17 | 지속 실패 안내 | 3회 연속 실패 시 "매장 직원에게 문의하세요" 안내 |

---

## 5. 주문 내역 조회 규칙

### 5.1 주문 목록
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| HISTORY-01 | 세션별 조회 | 현재 세션의 주문만 조회 (sessionId 기반) |
| HISTORY-02 | 최신순 정렬 | 주문을 생성 시각 역순으로 정렬 |
| HISTORY-03 | 목록 표시 정보 | 주문 번호, 주문 시각, 주문 상태, 총액 표시 |
| HISTORY-04 | 상태 배지 | 주문 상태별 색상 배지 (대기중: 노란색, 준비중: 파란색, 완료: 초록색) |
| HISTORY-05 | 빈 목록 안내 | 주문이 없으면 "아직 주문 내역이 없습니다" 안내 |

### 5.2 주문 상세
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| HISTORY-06 | 상세 보기 | 주문 목록에서 항목 클릭 시 상세 정보 표시 |
| HISTORY-07 | 상세 정보 | 주문 번호, 시각, 상태, 메뉴 목록(이름/수량/단가/소계), 총액 |
| HISTORY-08 | 돌아가기 | 상세에서 목록으로 돌아가기 버튼 제공 |

---

## 6. 라우팅 및 네비게이션 규칙

### 6.1 라우트 구조
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| NAV-01 | 상단 탭 | 상단에 "메뉴" / "주문내역" 2개 탭 제공 |
| NAV-02 | 하단 장바구니 바 | 하단에 장바구니 요약(수량, 총액) + "장바구니 보기" 버튼 고정 |
| NAV-03 | 장바구니 바 숨김 | 장바구니가 비어있으면 하단 바 숨김 또는 비활성 표시 |
| NAV-04 | 인증 가드 | 인증되지 않은 상태에서 보호된 경로 접근 시 TableSetupPage로 리다이렉트 |
| NAV-05 | 기본 경로 | 인증 완료 시 기본 경로는 메뉴 페이지 (`/`) |

### 6.2 페이지 전환 플로우
```
TableSetupPage ──(인증 성공)──> MenuPage
                                  │
                    ┌─────────────┼─────────────┐
                    │             │             │
                    v             v             v
              CartPage    OrderHistoryPage   (상단 탭)
                    │
                    v
            OrderConfirmPage
                    │
              ┌─────┴─────┐
              v           v
      OrderSuccessPage  (실패: 모달)
              │
              v (5초 후)
          MenuPage
```

---

## 7. 오류 처리 및 사용자 피드백 규칙

### 7.1 오류 유형별 UI 패턴
| 오류 유형 | UI 패턴 | 설명 |
|-----------|---------|------|
| 네트워크 오류 | 모달 | "네트워크 연결을 확인해주세요" + 재시도 버튼 |
| 서버 오류 (5xx) | 모달 | "서버 오류가 발생했습니다" + 재시도 버튼 |
| 세션 만료 | 모달 | "세션이 만료되었습니다" + 재설정 버튼 |
| 입력 검증 실패 | 인라인 | 해당 필드 아래에 오류 메시지 표시 |
| 메뉴 로딩 실패 | 토스트 | 상단 토스트 + 재시도 버튼 |
| 장바구니 저장 실패 | 토스트 | "장바구니 저장에 실패했습니다" 토스트 |
| 주문 실패 | 모달 | 오류 상세 + 재시도/취소 버튼 |

### 7.2 토스트 규칙
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| ERR-01 | 자동 사라짐 | 토스트는 3초 후 자동 사라짐 |
| ERR-02 | 위치 | 화면 상단 중앙에 표시 |
| ERR-03 | 중복 방지 | 동일 메시지 토스트 중복 표시 방지 |

### 7.3 모달 규칙
| 규칙 ID | 규칙 | 설명 |
|---------|------|------|
| ERR-04 | 배경 딤 처리 | 모달 표시 시 배경 어둡게 처리 |
| ERR-05 | 닫기 방법 | 버튼 클릭으로만 닫기 (배경 클릭 닫기 비활성) |
| ERR-06 | 재시도 포함 | retryable=true인 오류는 "재시도" 버튼 포함 |
